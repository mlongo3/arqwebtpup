<!doctype html>
<html class="no-js" lang="">

<head>
	<!-- Google Tag Manager -->
	<script>(function (w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-W7WJ8TR');</script>
	<!-- End Google Tag Manager -->

	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Garage Longo S.A.</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

	<link rel="manifest" href="site.webmanifest">
	<link rel="apple-touch-icon" href="icon.png">
	<!-- Place favicon.ico in the root directory -->
	<link href="https://fonts.googleapis.com/css?family=Raleway:300,400,500,600,700" rel="stylesheet">

	<link rel="stylesheet" href="../css/normalize.css">
	<link rel="stylesheet" href="../css/bootstrap.min.css">
	<link rel="stylesheet" href="../css/animate.css">
	<link rel="stylesheet" href="../css/icons.css">
	<link rel="stylesheet" href="../css/select2.css">
	<link rel="stylesheet" href="../css/datepicker.css">
	<link rel="stylesheet" href="../css/main.css">
	<style>
		.wow {
			visibility: hidden;
		}
	</style>
</head>

<body ng-app="Menu">
	<div class="overlay-nav"></div>
	<header class="flex">
		<a href="javascript:void(0);" class="logo"><img src="../img/logo.png" alt="AAP"></a>
		<h3 class="title-admin-head">Panel de administración</h3>

		<div class="header-right">
			<div class="user-top">
				<a href="javascript:void(0);" class="dropdown">
					<div class="user-pic" style="background-image: url('../img/avatars/avatar-user1.png')"></div>
					<h4 class='nameUser'></h4>
				</a>
				<ul>
					<li><a href="/perfilUsuario" data-icon="&#xe005;">Editar mi perfil</a></li>
					<li><a href="javascript:void(0)" data-icon="&#xe036;" onclick="signOut()">Cerrar sesión</a></li>
				</ul>
			</div>
		</div>

		<div class="burger open-nav pull-right">
			<span></span>
			<span></span>
			<span></span>
		</div>
	</header>

	<aside class="admin-nav" ng-controller="menuCtrl as ctrl">
		<div class="user-top show-mobile">
			<a href="javascript:void(0);" class="dropdown">
				<div class="user-pic" style="background-image: url('img/avatars/avatar-user1.png')"></div>
				<h4 class="nameUser"></h4>
			</a>
			<ul>
				<li><a href="/perfilUsuario" data-icon="&#xe005;">Editar mi perfil</a></li>
				<li><a href="javascript:void(0)" data-icon="&#xe036;" onclick="signOut()">Cerrar sesión</a></li>
			</ul>
		</div>

		<ul>
			<li><a href="/listausuarios" ng-show="rol != 'basic'"><i class="icon-user" !='basic'></i> Usuarios</a></li>
			<li><a href="/listaAlquiler" ng-show="rol == 'admin'"><i class="icon-user"></i> Alquileres</a></li>
			<li class="current" ><a href="/porton"><i class="icon-user"></i> Porton</a></li>
			<li><a href="/listacamaras" ng-show="rol == 'admin'"><i class="icon-user"></i> Camaras</a></li>
		</ul>
	</aside>

	<div class="admin-container">
		<div class="col-md-12">
			<div class="panel panel-profile">
				<h1 class="title-admin pull-left">PORTON</h1>
				<div class="col-md-12" style="text-align: center">
					<h3>Click para activar/desactivar monitoreo del porton.</h3>
				</div>
				<div class="clearfix"></div>
				<div class="col-md-12">
					<button id="btnMonitoreo" class="btn btn-xl btn-full btn-lightblue text-left m-t-20" onclick="activarMonitoreo()">Activar
						monitoreo</button>
				</div>
				<div class="clearfix"></div>
				<div class="col-md-12" style="text-align: center">
					<h3>Click para accionar el portón.</h3>
				</div>
				<div class="clearfix"></div>
				<div class="col-md-12">
					<button id="btnPorton" class="btn btn-xl btn-full btn-lightblue text-left m-t-20" onclick="activarPorton()">Accionar
						Porton</button>
				</div>

				<div class="clearfix"></div>
				<div class="col-md-12" style="text-align: center">
					<h3 id="lblEstado">Estado del porton: </h3>
				</div>

				<div class="clearfix"></div>
			</div>
		</div>
	</div>

	<!-- Add your site or application content here -->
	<script src="../js/vendor/modernizr-3.5.0.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	 crossorigin="anonymous"></script>
	<script>window.jQuery || document.write('<script src="js/vendor/jquery-3.2.1.min.js"><\/script>')</script>
	<script src="../js/plugins.js"></script>
	<script src="../js/select2.full.min.js"></script>
	<script src="../js/vivus.min.js"></script>
	<script src="../js/wow.min.js"></script>
	<script src="../js/jquery.easing.1.3.js"></script>
	<script src="../js/tooltip.js"></script>
	<script src="../js/slick.min.js"></script>
	<script src="../js/main.js"></script>
	<script src="../js/Angular/angular.min.js"></script>
	<script src="../js/Angular/angular-route.js"></script>
	<script src="../js/Angular/angular-sanitize.min.js"></script>
	<script src="../js/Angular/angular-strap.min.js"></script>
	<script src="../js/Angular/angular-strap.tpl.min.js"></script>
	<script src="../js/Angular/angular-messages.min.js"></script>
	<script src="../js/Angular/angular-animate.min.js"></script>
	<script src="../js/Angular/angular-aria.min.js"></script>
	<script src="../js/app.js"></script>
	<script src="../js/Angular/angular-locale_es-ar.js"></script>
	<script src="../js/Angular-Modules/Menu/menuModule.js"></script>
    <script src="../js/Angular-Modules/Menu/menuCtrl.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-filter/0.5.8/angular-filter.min.js"></script>
</body>

</html>



<!--<label id="lblEstado">TextoInicial</label>-->
<script type="text/javascript">
	//let userList = document.createElement('ul')	
	let monitoreoActivo = false
	let intervaloEstado;
	let estadoBox = document.createElement('LABEL')
	estadoBox.innerHTML = 'Sin revisión'
	document.getElementById("lblEstado").appendChild(estadoBox)
	//estadoBox.setAttribute('hola','lalala')

	function activarPorton() {
		fetch('/api/porton/activar', {
			method: 'POST',
			headers: {
				'authorization': `Bearer ${localStorage.token}`
			}
		})

		if (!monitoreoActivo) {
			activarMonitoreo()
		}
	}


	function activarMonitoreo() {
		if (!monitoreoActivo) {
			document.getElementById("btnMonitoreo").style.background = '#00FF00';
			var btn = document.getElementById("btnMonitoreo");
			btn.firstChild.data = "Monitoreo Activado"

			monitoreoActivo = true;
			intervaloEstado = setInterval(function () {
				fetch('/api/porton/getestado', {
					method: 'GET',
					headers: {
						'authorization': `Bearer ${localStorage.token}`
					}
				})
					.then(res => {
						if (res.status >= 400 && res.status < 600) {
							throw new Error(`Fallo con status: ${res.status}`);
						}
						return res.json();
					})
					.then(json => {
						console.log('Procesnado chequeo de esado')
						let valEstado = json.message;
						console.log(`El estado acutal es: ${valEstado}`)
						estadoBox.innerHTML = `${valEstado}`

						if (valEstado == 'detenido') {
							//clearInterval(intervaloEstado);
							estadoBox.style.color = "white"
							estadoBox.style.background = "green"
							console.log('Fin de proceso, porque esta detenido')
						}
						else if (valEstado == 'esperando') {
							estadoBox.style.color = "black"
							estadoBox.style.background = "orange"
						}
						else {
							estadoBox.style.color = "white"
							estadoBox.style.background = "red"
							console.log('Fin chequeo de estado')
						}
						document.getElementById("lblEstado").appendChild(estadoBox)
					})
					.catch((error) => {
						console.log('catch')
						clearInterval(intervaloEstado);
						console.log(`${error}`)
					})
			}, 1000)
		}
		else {
			monitoreoActivo = false;
			document.getElementById("btnMonitoreo").style.background = '';
			var btn = document.getElementById("btnMonitoreo");
			btn.firstChild.data = "Monitoreo Detenido"
			clearInterval(intervaloEstado);
		}
	}	
</script>

<script>
	$(".nameUser").text("" + localStorage.getItem('displayName'));
</script>